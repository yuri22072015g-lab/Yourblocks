<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>3D Parkour Game</title>
<style>
body { margin: 0; overflow: hidden; font-family: Arial; background: black; }
#ui {
position:absolute;
top:15px;
left:15px;
background:rgba(0,0,0,0.6);
color:white;
padding:12px 15px;
border-radius:8px;
font-size:14px;
}
#menu {
position:absolute;
width:100%;
height:100%;
display:flex;
justify-content:center;
align-items:center;
background:#111;
color:white;
flex-direction:column;
}
button {
padding:15px 30px;
font-size:18px;
cursor:pointer;
border:none;
border-radius:8px;
background:#00aaff;
color:white;
}
</style>
</head>
<body>

<div id="menu">
<h1>3D Parkour</h1>
<button onclick="startGame()">Играть</button>
</div>

<div id="ui" style="display:none;">
WASD — движение<br>
Пробел — прыжок<br>
Мышь — обзор<br>
Колёсико — зум
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/cannon@0.6.2/build/cannon.min.js"></script>

<script>
function startGame(){
document.getElementById("menu").style.display="none";
document.getElementById("ui").style.display="block";
init();
animate();
}

let scene,camera,renderer,world,playerBody,playerGroup,yawObject,pitchObject;
let cameraDistance=7,minDistance=3,maxDistance=15;
let keys={},clock=new THREE.Clock(),walkTime=0;

function init(){

scene=new THREE.Scene();
scene.background=new THREE.Color(0x87ceeb);

camera=new THREE.PerspectiveCamera(75,window.innerWidth/window.innerHeight,0.1,2000);

renderer=new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth,window.innerHeight);
document.body.appendChild(renderer.domElement);

yawObject=new THREE.Object3D();
pitchObject=new THREE.Object3D();
yawObject.add(pitchObject);
pitchObject.add(camera);
scene.add(yawObject);
camera.position.set(0,2.5,cameraDistance);

scene.add(new THREE.AmbientLight(0xffffff,0.6));
let light=new THREE.DirectionalLight(0xffffff,0.8);
light.position.set(20,30,10);
scene.add(light);

world=new CANNON.World();
world.gravity.set(0,-9.82,0);

let groundMat=new CANNON.Material("ground");
let playerMat=new CANNON.Material("player");

world.addContactMaterial(new CANNON.ContactMaterial(playerMat,groundMat,{friction:0.05}));

let groundMesh=new THREE.Mesh(
new THREE.BoxGeometry(20,2,20),
new THREE.MeshStandardMaterial({color:0x444444})
);
groundMesh.position.set(0,0,10);
scene.add(groundMesh);

let groundBody=new CANNON.Body({mass:0,material:groundMat});
groundBody.addShape(new CANNON.Box(new CANNON.Vec3(10,1,10)));
groundBody.position.copy(groundMesh.position);
world.addBody(groundBody);

for(let i=0;i<40;i++){
let mesh=new THREE.Mesh(
new THREE.BoxGeometry(4,1,4),
new THREE.MeshStandardMaterial({color:new THREE.Color().setHSL(i/40,0.8,0.5)})
);
mesh.position.set(0,2,-i*8);
scene.add(mesh);

let body=new CANNON.Body({mass:0,material:groundMat});
body.addShape(new CANNON.Box(new CANNON.Vec3(2,0.5,2)));
body.position.copy(mesh.position);
world.addBody(body);
}

playerBody=new CANNON.Body({mass:5,material:playerMat,linearDamping:0.9,fixedRotation:true});
playerBody.addShape(new CANNON.Sphere(0.9));
playerBody.position.set(0,8,5);
world.addBody(playerBody);

playerGroup=new THREE.Group();

let bodyMat=new THREE.MeshStandardMaterial({color:0x0066ff});
let limbMat=new THREE.MeshStandardMaterial({color:0x003399});
let headMat=new THREE.MeshStandardMaterial({color:0xffffff});

let torso=new THREE.Mesh(new THREE.BoxGeometry(1.2,2,0.8),bodyMat);
torso.position.y=1.6;
playerGroup.add(torso);

let head=new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),headMat);
head.position.y=3;
playerGroup.add(head);

let leftLeg=new THREE.Mesh(new THREE.BoxGeometry(0.7,1.8,0.7),limbMat);
leftLeg.position.set(-0.4,0.2,0);
playerGroup.add(leftLeg);

let rightLeg=new THREE.Mesh(new THREE.BoxGeometry(0.7,1.8,0.7),limbMat);
rightLeg.position.set(0.4,0.2,0);
playerGroup.add(rightLeg);

let leftArm=new THREE.Mesh(new THREE.BoxGeometry(0.5,1.8,0.5),limbMat);
leftArm.position.set(-0.8,1.8,0);
playerGroup.add(leftArm);

let rightArm=new THREE.Mesh(new THREE.BoxGeometry(0.5,1.8,0.5),limbMat);
rightArm.position.set(0.8,1.8,0);
playerGroup.add(rightArm);

scene.add(playerGroup);

document.addEventListener("keydown",e=>keys[e.code]=true);
document.addEventListener("keyup",e=>keys[e.code]=false);

document.body.addEventListener("click",()=>document.body.requestPointerLock());

document.addEventListener("mousemove",e=>{
if(document.pointerLockElement===document.body){
yawObject.rotation.y-=e.movementX*0.002;
pitchObject.rotation.x-=e.movementY*0.002;
pitchObject.rotation.x=Math.max(-Math.PI/3,Math.min(Math.PI/3,pitchObject.rotation.x));
}
});

document.addEventListener("wheel",e=>{
cameraDistance+=e.deltaY*0.01;
cameraDistance=Math.max(minDistance,Math.min(maxDistance,cameraDistance));
camera.position.set(0,2.5,cameraDistance);
});

}

function animate(){
requestAnimationFrame(animate);

let delta=clock.getDelta();
world.step(1/60,delta,3);

let moveSpeed=8;

let forward=new THREE.Vector3(0,0,-1).applyQuaternion(yawObject.quaternion);
let right=new THREE.Vector3(1,0,0).applyQuaternion(yawObject.quaternion);

let moveX=0,moveZ=0;

if(keys["KeyW"]){moveX+=forward.x;moveZ+=forward.z;}
if(keys["KeyS"]){moveX-=forward.x;moveZ-=forward.z;}
if(keys["KeyA"]){moveX-=right.x;moveZ-=right.z;}
if(keys["KeyD"]){moveX+=right.x;moveZ+=right.z;}

playerBody.velocity.x=moveX*moveSpeed;
playerBody.velocity.z=moveZ*moveSpeed;

if(keys["Space"] && Math.abs(playerBody.velocity.y)<0.1){
playerBody.velocity.y=9;
}

let moving=Math.abs(moveX)>0||Math.abs(moveZ)>0;

if(moving){
walkTime+=delta*8;
let swing=Math.sin(walkTime)*0.6;
playerGroup.children[2].rotation.x=swing;
playerGroup.children[3].rotation.x=-swing;
playerGroup.children[4].rotation.x=-swing;
playerGroup.children[5].rotation.x=swing;
}else{
playerGroup.children[2].rotation.x=0;
playerGroup.children[3].rotation.x=0;
playerGroup.children[4].rotation.x=0;
playerGroup.children[5].rotation.x=0;
}

playerGroup.position.copy(playerBody.position);
yawObject.position.copy(playerBody.position);

renderer.render(scene,camera);
}
</script>

</body>
</html>