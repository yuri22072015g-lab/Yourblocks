<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Yourblocks ‚Äî –ú—É–ª—å—Ç–∏–ø–ª–µ–µ—Ä —á–µ—Ä–µ–∑ WebSocket</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Roboto', sans-serif;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            overflow: hidden;
            background: #141414;
            touch-action: none;
        }
        
        /* –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ */
        #login-screen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s;
        }
        
        .login-container {
            background: rgba(30, 30, 40, 0.95);
            backdrop-filter: blur(10px);
            padding: 40px;
            border-radius: 30px;
            width: 90%;
            max-width: 400px;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 50px rgba(76, 175, 80, 0.3);
            animation: slideUp 0.5s;
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .login-logo {
            text-align: center;
            font-size: 48px;
            margin-bottom: 20px;
            color: #4CAF50;
        }
        
        .login-title {
            text-align: center;
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 10px;
            color: white;
        }
        
        .login-subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .login-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px;
            border-radius: 50px;
        }
        
        .login-tab {
            flex: 1;
            padding: 12px;
            text-align: center;
            border-radius: 40px;
            cursor: pointer;
            transition: all 0.3s;
            color: #888;
            font-weight: bold;
        }
        
        .login-tab.active {
            background: #4CAF50;
            color: white;
        }
        
        .login-form {
            display: none;
        }
        
        .login-form.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateX(10px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        .input-group label {
            display: block;
            color: #888;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid #333;
            border-radius: 15px;
            color: white;
            font-size: 16px;
            transition: all 0.3s;
        }
        
        .input-group input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .login-btn {
            width: 100%;
            padding: 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            margin-bottom: 15px;
        }
        
        .login-btn:hover {
            transform: scale(1.02);
            background: #45a049;
        }
        
        .guest-btn {
            width: 100%;
            padding: 15px;
            background: transparent;
            color: #888;
            border: 2px solid #333;
            border-radius: 15px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .guest-btn:hover {
            border-color: #4CAF50;
            color: white;
        }
        
        .error-message {
            color: #ff5555;
            font-size: 14px;
            margin-top: 10px;
            text-align: center;
            display: none;
        }
        
        /* –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é */
        #menu-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #141414;
            z-index: 1000;
            display: none;
            flex-direction: column;
            overflow-y: auto;
            color: white;
        }
        
        /* –ë–æ–∫–æ–≤–æ–µ –º–µ–Ω—é */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100%;
            background: #1e1e1e;
            padding: 20px 0;
            border-right: 1px solid #333;
            z-index: 100;
        }
        
        .sidebar-header {
            padding: 0 20px 20px 20px;
            border-bottom: 1px solid #333;
        }
        
        .logo {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
            margin-bottom: 20px;
        }
        
        .logo span {
            color: #4CAF50;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .user-avatar {
            width: 50px;
            height: 50px;
            background: #2a2a2a;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 2px solid #4CAF50;
        }
        
        .user-info-side {
            flex: 1;
        }
        
        .user-name {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 4px;
            color: #fff;
        }
        
        .user-status {
            font-size: 12px;
            color: #4CAF50;
        }
        
        .user-status span {
            color: #888;
            margin-left: 5px;
        }
        
        .nav-menu {
            padding: 20px 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .nav-item:hover {
            background: #2a2a2a;
            color: #fff;
        }
        
        .nav-item.active {
            background: #4CAF50;
            color: white;
        }
        
        .nav-item i {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }
        
        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            margin-left: 250px;
            padding: 20px 30px;
            min-height: 100vh;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .content-header h1 {
            font-size: 28px;
            color: #fff;
        }
        
        .header-stats {
            display: flex;
            gap: 20px;
            color: #888;
        }
        
        .header-stats span {
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* –°–µ–∫—Ü–∏–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ */
        .content-section {
            display: none;
        }
        
        .content-section.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        /* –ö–∞—Ä—Ç–æ—á–∫–∞ –∏–≥—Ä—ã */
        .game-card-large {
            background: #1e1e1e;
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .game-card-large:hover {
            transform: translateY(-5px);
            border-color: #4CAF50;
        }
        
        .game-card-large.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 40px rgba(76, 175, 80, 0.4);
        }
        
        .game-image-large {
            height: 200px;
            background: linear-gradient(135deg, #2a5a2a, #1a3a1a);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 64px;
            position: relative;
        }
        
        .game-image-large::after {
            content: '‚ñ∂';
            position: absolute;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #4CAF50;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            opacity: 0;
            transition: opacity 0.3s;
        }
        
        .game-card-large:hover .game-image-large::after {
            opacity: 1;
        }
        
        .game-info-large {
            padding: 25px;
            text-align: center;
        }
        
        .game-title-large {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #4CAF50;
        }
        
        .game-description-large {
            font-size: 16px;
            color: #888;
            margin-bottom: 20px;
        }
        
        .game-features {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .feature {
            text-align: center;
        }
        
        .feature-icon {
            font-size: 24px;
            margin-bottom: 5px;
        }
        
        .feature-text {
            font-size: 14px;
            color: #888;
        }
        
        .feature-text span {
            color: #4CAF50;
            font-weight: bold;
        }
        
        /* –ü—Ä–æ—Ñ–∏–ª—å */
        .profile-header {
            background: #1e1e1e;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            display: flex;
            gap: 30px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .profile-avatar-large {
            width: 120px;
            height: 120px;
            background: #2a2a2a;
            border-radius: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
            border: 4px solid #4CAF50;
        }
        
        .profile-info h2 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #fff;
        }
        
        .profile-stats {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: #4CAF50;
        }
        
        .stat-label {
            color: #888;
            font-size: 13px;
        }
        
        /* –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è */
        .customization-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
        }
        
        .color-section {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
        }
        
        .color-section h3 {
            margin-bottom: 15px;
            color: #fff;
            font-size: 16px;
        }
        
        .color-picker {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .color-option {
            width: 45px;
            height: 45px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
        }
        
        .color-option:hover {
            transform: scale(1.1);
        }
        
        .color-option.selected {
            border-color: white;
            box-shadow: 0 0 15px currentColor;
        }
        
        /* –ö–Ω–æ–ø–∫–∞ Play */
        .play-button {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 10px 30px rgba(76, 175, 80, 0.5);
            z-index: 1001;
            transition: all 0.3s;
            border: 2px solid rgba(255, 255, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .play-button:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 40px rgba(76, 175, 80, 0.7);
        }
        
        .play-button:active {
            transform: scale(0.95);
        }
        
        /* –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä */
        #game-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1;
            display: none;
        }
        
        #game-container.active {
            display: block;
        }
        
        .game-exit-button {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 200;
            background: rgba(255, 80, 80, 0.9);
            color: white;
            border: 2px solid white;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            font-size: 24px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 20px rgba(255,0,0,0.5);
            transition: all 0.3s;
        }
        
        .game-exit-button:hover {
            transform: scale(1.1);
            background: rgba(255, 40, 40, 1);
        }
        
        .game-exit-button:active {
            transform: scale(0.95);
        }
        
        .exit-hint {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 200;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 30px;
            font-size: 12px;
            border: 1px solid #ff5555;
            backdrop-filter: blur(5px);
        }
        
        /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã */
        .ground-indicator {
            position: absolute;
            bottom: 100px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            border: 2px solid #4CAF50;
            z-index: 200;
            backdrop-filter: blur(5px);
            transition: all 0.3s;
        }
        
        .ground-indicator.onground {
            border-color: #4CAF50;
            color: #4CAF50;
        }
        
        .ground-indicator.air {
            border-color: #ff5555;
            color: #ff5555;
        }
        
        .players-count {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 200;
            background: rgba(0,0,0,0.7);
            color: #4CAF50;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            border: 2px solid #4CAF50;
            backdrop-filter: blur(5px);
        }
        
        .server-status {
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 200;
            background: rgba(0,0,0,0.7);
            color: #4CAF50;
            padding: 8px 20px;
            border-radius: 30px;
            font-size: 14px;
            border: 2px solid #4CAF50;
            backdrop-filter: blur(5px);
            white-space: nowrap;
        }
        
        .jump-hint {
            position: absolute;
            bottom: 150px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255,255,255,0.5);
            font-size: 12px;
            z-index: 200;
        }
        
        /* –°–µ–∫—Ü–∏—è –¥—Ä—É–∑–µ–π */
        .friends-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .search-section {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
        }
        
        .search-title {
            color: #fff;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .search-box input {
            flex: 1;
            padding: 12px;
            background: #2a2a2a;
            border: 2px solid #333;
            border-radius: 12px;
            color: white;
            font-size: 16px;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        .search-box button {
            padding: 12px 25px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .search-box button:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        /* –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ */
        .all-players-section {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
        }
        
        .all-players-title {
            color: #fff;
            margin-bottom: 15px;
            font-size: 18px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .all-players-list {
            max-height: 200px;
            overflow-y: auto;
            background: #2a2a2a;
            border-radius: 12px;
            padding: 10px;
        }
        
        .player-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px;
            background: #333;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
        }
        
        .player-item:hover {
            background: #3a3a3a;
        }
        
        .player-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .player-avatar-small {
            width: 40px;
            height: 40px;
            background: #2a2a2a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 2px solid #4CAF50;
        }
        
        .player-name {
            font-weight: bold;
            color: #fff;
        }
        
        .player-status {
            font-size: 12px;
            color: #888;
        }
        
        .player-status.online {
            color: #4CAF50;
        }
        
        .friend-btn {
            padding: 8px 15px;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 120px;
            text-align: center;
        }
        
        .friend-btn.pending {
            background: #ffaa00;
        }
        
        .friend-btn.accepted {
            background: #4CAF50;
            opacity: 0.7;
            cursor: default;
        }
        
        .friend-btn.rejected {
            background: #ff5555;
        }
        
        .friend-btn.joined {
            background: #4CAF50;
        }
        
        .friend-btn:hover:not(.accepted) {
            transform: scale(1.05);
        }
        
        .search-results {
            max-height: 200px;
            overflow-y: auto;
            background: #2a2a2a;
            border-radius: 12px;
            padding: 10px;
            margin-top: 10px;
        }
        
        .friends-lists {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        
        .friends-column {
            background: #1e1e1e;
            border-radius: 16px;
            padding: 20px;
        }
        
        .friends-column h3 {
            color: #fff;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .friends-list {
            max-height: 300px;
            overflow-y: auto;
            background: #2a2a2a;
            border-radius: 12px;
            padding: 10px;
        }
        
        .friend-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px;
            background: #333;
            border-radius: 10px;
            margin-bottom: 8px;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .friend-card:hover {
            background: #3a3a3a;
        }
        
        .friend-card.online {
            border-left: 4px solid #4CAF50;
        }
        
        .friend-card.offline {
            border-left: 4px solid #888;
        }
        
        .friend-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .friend-avatar {
            width: 45px;
            height: 45px;
            background: #2a2a2a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 22px;
            border: 2px solid #4CAF50;
        }
        
        .friend-details {
            display: flex;
            flex-direction: column;
        }
        
        .friend-name {
            font-weight: bold;
            color: #fff;
            font-size: 16px;
        }
        
        .friend-last-seen {
            font-size: 12px;
            color: #888;
        }
        
        .friend-last-seen.online {
            color: #4CAF50;
        }
        
        .friend-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .action-btn.accept {
            background: #4CAF50;
            color: white;
        }
        
        .action-btn.reject {
            background: #ff5555;
            color: white;
        }
        
        .action-btn.join {
            background: #4CAF50;
            color: white;
        }
        
        .action-btn.remove {
            background: #ff5555;
            color: white;
        }
        
        .action-btn:hover {
            transform: scale(1.05);
        }
        
        .no-friends {
            color: #888;
            text-align: center;
            padding: 20px;
            font-style: italic;
        }
        
        /* –ú–û–ë–ò–õ–¨–ù–û–ï –£–ü–†–ê–í–õ–ï–ù–ò–ï */
        #mobile-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 150;
            pointer-events: none;
            display: none;
        }
        
        #mobile-controls.active {
            display: block;
        }
        
        #left-area {
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            z-index: 151;
            pointer-events: auto;
            background: transparent;
            touch-action: none;
        }
        
        #right-area {
            position: absolute;
            top: 0;
            right: 0;
            width: 50%;
            height: 100%;
            z-index: 151;
            pointer-events: auto;
            background: transparent;
            touch-action: none;
        }
        
        #joystick-left {
            position: absolute;
            bottom: 40px;
            left: 40px;
            width: 120px;
            height: 120px;
            background: rgba(30, 30, 40, 0.7);
            border-radius: 60px;
            backdrop-filter: blur(10px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 0 30px rgba(0,0,0,0.5);
            z-index: 152;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        #joystick-handle {
            width: 50px;
            height: 50px;
            background: rgba(76, 175, 80, 0.9);
            border-radius: 25px;
            box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
            transition: transform 0.01s;
            border: 2px solid white;
        }
        
        #jump-button {
            position: absolute;
            bottom: 40px;
            right: 40px;
            width: 100px;
            height: 100px;
            background: rgba(255, 80, 80, 0.9);
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 3px solid white;
            box-shadow: 0 0 30px rgba(255, 0, 0, 0.5);
            z-index: 152;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.1s;
        }
        
        #jump-button.active {
            transform: scale(0.9);
            background: rgba(255, 40, 40, 1);
        }
        
        .logout-btn {
            position: fixed;
            top: 20px;
            left: 270px;
            background: rgba(255, 80, 80, 0.9);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 30px;
            font-size: 14px;
            cursor: pointer;
            z-index: 1002;
            display: flex;
            align-items: center;
            gap: 8px;
            border: 2px solid white;
            transition: all 0.3s;
        }
        
        .logout-btn:hover {
            background: rgba(255, 40, 40, 1);
            transform: scale(1.05);
        }
        
        .logout-btn:active {
            transform: scale(0.95);
        }
        
        @media (max-width: 768px) {
            .sidebar {
                width: 70px;
                overflow: hidden;
            }
            
            .sidebar .logo,
            .user-profile,
            .nav-item span {
                display: none;
            }
            
            .main-content {
                margin-left: 70px;
                padding: 15px;
            }
            
            .nav-item {
                justify-content: center;
                padding: 15px;
            }
            
            .nav-item i {
                margin: 0;
                font-size: 24px;
            }
            
            .profile-header {
                flex-direction: column;
                text-align: center;
            }
            
            .game-features {
                flex-direction: column;
                gap: 15px;
            }
            
            .play-button {
                bottom: 20px;
                right: 20px;
                padding: 12px 25px;
                font-size: 16px;
            }
            
            .logout-btn {
                left: 90px;
                padding: 8px 15px;
                font-size: 12px;
            }
            
            .game-exit-button {
                width: 60px;
                height: 60px;
                font-size: 30px;
            }
            
            .server-status {
                font-size: 12px;
                padding: 5px 10px;
                top: 10px;
            }
            
            .players-count {
                font-size: 12px;
                padding: 5px 10px;
                top: 10px;
                left: 10px;
            }
            
            #joystick-left {
                width: 100px;
                height: 100px;
                bottom: 30px;
                left: 30px;
            }
            
            #joystick-handle {
                width: 40px;
                height: 40px;
            }
            
            #jump-button {
                width: 80px;
                height: 80px;
                bottom: 30px;
                right: 30px;
                font-size: 16px;
            }
            
            .friends-lists {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <!-- Socket.io –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    <script>
        document.addEventListener('contextmenu', function(e) {
            e.preventDefault();
            return false;
        });
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'F12') {
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J' || e.key === 'C')) {
                e.preventDefault();
                return false;
            }
            if (e.ctrlKey && e.key === 'U') {
                e.preventDefault();
                return false;
            }
        });
    </script>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞ -->
    <div id="login-screen">
        <div class="login-container">
            <div class="login-logo">üß±</div>
            <div class="login-title">YOURBLOCKS</div>
            <div class="login-subtitle">–í–æ–π–¥–∏, —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å</div>
            
            <div class="login-tabs">
                <div class="login-tab active" onclick="switchLoginTab('login')">–í—Ö–æ–¥</div>
                <div class="login-tab" onclick="switchLoginTab('register')">–†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è</div>
            </div>
            
            <div id="login-form" class="login-form active">
                <div class="input-group">
                    <label>üë§ –õ–æ–≥–∏–Ω</label>
                    <input type="text" id="login-username" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="input-group">
                    <label>üîí –ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="login-password" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="login-btn" onclick="handleLogin()">–í–æ–π—Ç–∏</button>
                <button class="guest-btn" onclick="handleGuest()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å</button>
                <div id="login-error" class="error-message"></div>
            </div>
            
            <div id="register-form" class="login-form">
                <div class="input-group">
                    <label>üë§ –õ–æ–≥–∏–Ω</label>
                    <input type="text" id="register-username" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                </div>
                <div class="input-group">
                    <label>üîí –ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="register-password" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <div class="input-group">
                    <label>üîí –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ</label>
                    <input type="password" id="register-confirm" placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                </div>
                <button class="login-btn" onclick="handleRegister()">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è</button>
                <button class="guest-btn" onclick="handleGuest()">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –∫–∞–∫ –≥–æ—Å—Ç—å</button>
                <div id="register-error" class="error-message"></div>
            </div>
        </div>
    </div>
    
    <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
    <div id="menu-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="logo">YOUR<span>BLOCKS</span></div>
                <div class="user-profile">
                    <div class="user-avatar" id="sidebar-avatar">üß±</div>
                    <div class="user-info-side">
                        <div class="user-name" id="sidebar-username">–ì–æ—Å—Ç—å</div>
                        <div class="user-status" id="sidebar-status">50 <span>–ë–ª–∏–∑–∫–∏–π</span></div>
                    </div>
                </div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item active" onclick="switchPage('home')">
                    <i>üè†</i>
                    <span>–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</span>
                </div>
                <div class="nav-item" onclick="switchPage('profile')">
                    <i>üë§</i>
                    <span>–ü—Ä–æ—Ñ–∏–ª—å</span>
                </div>
                <div class="nav-item" onclick="switchPage('avatar')">
                    <i>üé®</i>
                    <span>–ê–≤–∞—Ç–∞—Ä</span>
                </div>
                <div class="nav-item" onclick="switchPage('friends')">
                    <i>üë•</i>
                    <span>–î—Ä—É–∑—å—è</span>
                </div>
            </div>
        </div>
        
        <button class="logout-btn" onclick="logout()">
            <span>üö™</span> –í—ã–π—Ç–∏
        </button>
        
        <div class="main-content">
            <div class="content-header">
                <h1 id="page-title">–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞</h1>
                <div class="header-stats">
                    <div>üë• <span id="global-online">0</span> –æ–Ω–ª–∞–π–Ω</div>
                    <div>üéÆ <span>1</span> –∏–≥—Ä–∞</div>
                </div>
            </div>
            
            <div id="home-section" class="content-section active">
                <h2 style="color: #fff; margin-bottom: 30px; text-align: center;">üî• –ò–≥—Ä–∞ –¥–Ω—è</h2>
                
                <div class="game-card-large" onclick="selectGame()">
                    <div class="game-image-large">üèÉ‚Äç‚ôÇÔ∏è</div>
                    <div class="game-info-large">
                        <div class="game-title-large">PARKOUR MAZE</div>
                        <div class="game-description-large">–ü–∞—Ä–∫—É—Ä + –õ–∞–±–∏—Ä–∏–Ω—Ç ‚Äî –æ–±—â–∏–π —Å–µ—Ä–≤–µ—Ä!</div>
                        
                        <div class="game-features">
                            <div class="feature">
                                <div class="feature-icon">üèÉ</div>
                                <div class="feature-text"><span>20</span> –ø–ª–∞—Ç—Ñ–æ—Ä–º</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">üß±</div>
                                <div class="feature-text"><span>–ª–∞–±–∏—Ä–∏–Ω—Ç</span> —Å–ø—Ä–∞–≤–∞</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">üåê</div>
                                <div class="feature-text"><span>WebSocket</span> —Å–µ—Ä–≤–µ—Ä</div>
                            </div>
                            <div class="feature">
                                <div class="feature-icon">üë•</div>
                                <div class="feature-text"><span id="game-players">0</span> —Å–µ–π—á–∞—Å</div>
                            </div>
                        </div>
                        
                        <div style="margin-top: 25px; color: #4CAF50; font-size: 18px;">
                            ‚≠ê 4.9 (2.5K –æ—Ç–∑—ã–≤–æ–≤)
                        </div>
                    </div>
                </div>
                
                <div id="selected-game-info" style="margin-top: 30px; padding: 20px; background: #1e1e1e; border-radius: 16px;">
                    <div style="display: flex; justify-content: center;">
                        <button class="play-button" style="position: static;" onclick="startGame()">‚ñ∂ –í–û–ô–¢–ò –ù–ê –°–ï–†–í–ï–†</button>
                    </div>
                </div>
            </div>
            
            <div id="profile-section" class="content-section">
                <div class="profile-header">
                    <div class="profile-avatar-large" id="profile-avatar">üß±</div>
                    <div class="profile-info">
                        <h2 id="profile-username">–ì–æ—Å—Ç—å</h2>
                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-value">50</div>
                                <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value" id="profile-friends-count">0</div>
                                <div class="stat-label">–î—Ä—É–∑—å—è</div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-value">567</div>
                                <div class="stat-label">–ò–≥—Ä—ã</div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h3 style="color: #fff; margin: 20px 0;">–ù–µ–¥–∞–≤–Ω–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                <div style="background: #1e1e1e; border-radius: 16px; padding: 20px;">
                    <p style="color: #888;">üèÜ –ü—Ä–æ–π–¥–µ–Ω –ª–∞–±–∏—Ä–∏–Ω—Ç –∑–∞ 2 –º–∏–Ω—É—Ç—ã</p>
                    <p style="color: #888;">‚≠ê –°–æ–±—Ä–∞–Ω–æ 50 –º–æ–Ω–µ—Ç –≤ –ø–∞—Ä–∫—É—Ä–µ</p>
                    <p style="color: #888;">üöÄ 100 –ø—Ä—ã–∂–∫–æ–≤ –±–µ–∑ –ø–∞–¥–µ–Ω–∏—è</p>
                </div>
            </div>
            
            <div id="avatar-section" class="content-section">
                <h2 style="color: #fff; margin-bottom: 20px;">–ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è –∞–≤–∞—Ç–∞—Ä–∞</h2>
                
                <div style="display: flex; gap: 30px; margin-bottom: 30px; flex-wrap: wrap;">
                    <div class="profile-avatar-large" id="customize-avatar">üß±</div>
                    <div style="flex: 1; min-width: 200px;">
                        <p style="color: #888;">–ù–∞—Å—Ç—Ä–æ–π –≤–Ω–µ—à–Ω–æ—Å—Ç—å —Å–≤–æ–µ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞</p>
                    </div>
                </div>
                
                <div class="customization-grid">
                    <div class="color-section">
                        <h3>üë§ –ì–æ–ª–æ–≤–∞</h3>
                        <div class="color-picker">
                            <div class="color-option" style="background: #ffccaa;" onclick="setPartColor('head', '#ffccaa', this)"></div>
                            <div class="color-option" style="background: #8b5a2b;" onclick="setPartColor('head', '#8b5a2b', this)"></div>
                            <div class="color-option" style="background: #f5deb3;" onclick="setPartColor('head', '#f5deb3', this)"></div>
                            <div class="color-option" style="background: #d2b48c;" onclick="setPartColor('head', '#d2b48c', this)"></div>
                            <div class="color-option" style="background: #cd853f;" onclick="setPartColor('head', '#cd853f', this)"></div>
                        </div>
                    </div>
                    
                    <div class="color-section">
                        <h3>üëï –¢–µ–ª–æ</h3>
                        <div class="color-picker">
                            <div class="color-option" style="background: #3366ff;" onclick="setPartColor('body', '#3366ff', this)"></div>
                            <div class="color-option" style="background: #ff4444;" onclick="setPartColor('body', '#ff4444', this)"></div>
                            <div class="color-option" style="background: #44ff44;" onclick="setPartColor('body', '#44ff44', this)"></div>
                            <div class="color-option" style="background: #ffff44;" onclick="setPartColor('body', '#ffff44', this)"></div>
                            <div class="color-option" style="background: #ff44ff;" onclick="setPartColor('body', '#ff44ff', this)"></div>
                        </div>
                    </div>
                    
                    <div class="color-section">
                        <h3>ü¶µ –ù–æ–≥–∏</h3>
                        <div class="color-picker">
                            <div class="color-option" style="background: #2244aa;" onclick="setPartColor('legs', '#2244aa', this)"></div>
                            <div class="color-option" style="background: #aa2222;" onclick="setPartColor('legs', '#aa2222', this)"></div>
                            <div class="color-option" style="background: #22aa22;" onclick="setPartColor('legs', '#22aa22', this)"></div>
                            <div class="color-option" style="background: #aaaa22;" onclick="setPartColor('legs', '#aaaa22', this)"></div>
                            <div class="color-option" style="background: #aa22aa;" onclick="setPartColor('legs', '#aa22aa', this)"></div>
                        </div>
                    </div>
                    
                    <div class="color-section">
                        <h3>ü´± –†—É–∫–∏</h3>
                        <div class="color-picker">
                            <div class="color-option" style="background: #2244aa;" onclick="setPartColor('arms', '#2244aa', this)"></div>
                            <div class="color-option" style="background: #aa2222;" onclick="setPartColor('arms', '#aa2222', this)"></div>
                            <div class="color-option" style="background: #22aa22;" onclick="setPartColor('arms', '#22aa22', this)"></div>
                            <div class="color-option" style="background: #aaaa22;" onclick="setPartColor('arms', '#aaaa22', this)"></div>
                            <div class="color-option" style="background: #aa22aa;" onclick="setPartColor('arms', '#aa22aa', this)"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- –°–µ–∫—Ü–∏—è –¥—Ä—É–∑–µ–π -->
            <div id="friends-section" class="content-section">
                <div class="friends-container">
                    <!-- –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤ -->
                    <div class="search-section">
                        <h3 class="search-title">üîç –ü–æ–∏—Å–∫ –∏–≥—Ä–æ–∫–æ–≤</h3>
                        <div class="search-box">
                            <input type="text" id="search-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫–Ω–µ–π–º –∏–ª–∏ –µ–≥–æ —á–∞—Å—Ç—å..." oninput="searchPlayers()">
                            <button onclick="searchPlayers()">–ü–æ–∏—Å–∫</button>
                        </div>
                        <div id="search-results" class="search-results">
                            <div class="no-friends">–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞</div>
                        </div>
                    </div>
                    
                    <!-- –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ -->
                    <div class="all-players-section">
                        <div class="all-players-title">
                            <span>üë• –í—Å–µ –∏–≥—Ä–æ–∫–∏</span>
                            <span id="total-players-count">0</span>
                        </div>
                        <div id="all-players-list" class="all-players-list">
                            <div class="no-friends">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
                        </div>
                    </div>
                    
                    <!-- –ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è –∏ –¥—Ä—É–∑—å—è -->
                    <div class="friends-lists">
                        <div class="friends-column">
                            <h3>üì® –ó–∞—è–≤–∫–∏ –≤ –¥—Ä—É–∑—å—è</h3>
                            <div id="friend-requests" class="friends-list">
                                <div class="no-friends">–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫</div>
                            </div>
                        </div>
                        
                        <div class="friends-column">
                            <h3>üë• –ú–æ–∏ –¥—Ä—É–∑—å—è</h3>
                            <div id="my-friends" class="friends-list">
                                <div class="no-friends">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- –ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä -->
    <div id="game-container">
        <button class="game-exit-button" onclick="exitGame()">‚úï</button>
        <div class="exit-hint">–ù–∞–∂–º–∏ ESC –∏–ª–∏ ‚úï —á—Ç–æ–±—ã –≤—ã–π—Ç–∏</div>
        <div class="server-status" id="server-status">üîµ –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –°–ï–†–í–ï–†–£...</div>
        <div class="players-count" id="players-count">üë• 1 –≤ –º–∏—Ä–µ</div>
        <div class="ground-indicator onground" id="ground-indicator">üü¢ –ù–ê –ó–ï–ú–õ–ï</div>
        <div class="jump-hint">üëÜ –õ–µ–≤–∞—è —á–∞—Å—Ç—å - –¥–≤–∏–∂–µ–Ω–∏–µ, –ø—Ä–∞–≤–∞—è - –∫–∞–º–µ—Ä–∞ + –ø—Ä—ã–∂–æ–∫</div>
        
        <div id="mobile-controls">
            <div id="left-area"></div>
            <div id="right-area"></div>
            <div id="joystick-left">
                <div id="joystick-handle"></div>
            </div>
            <div id="jump-button">
                –ü–†–´–ñ–û–ö
            </div>
        </div>
        
        <div id="game-canvas"></div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/cannon@0.6.2/build/cannon.min.js"></script>
    
    <script>
        // ==================== –°–ò–°–¢–ï–ú–ê –ê–ö–ö–ê–£–ù–¢–û–í ====================
        let currentUser = null;
        let users = {};
        
        try {
            const saved = localStorage.getItem('yourblocks_users');
            if (saved) {
                users = JSON.parse(saved);
            }
        } catch (e) {}
        
        function saveUsers() {
            localStorage.setItem('yourblocks_users', JSON.stringify(users));
        }
        
        function switchLoginTab(tab) {
            document.querySelectorAll('.login-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            document.getElementById(tab + '-form').classList.add('active');
        }
        
        function handleLogin() {
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorDiv = document.getElementById('login-error');
            
            if (!username || !password) {
                errorDiv.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (!users[username]) {
                errorDiv.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (users[username].password !== password) {
                errorDiv.textContent = '–ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å';
                errorDiv.style.display = 'block';
                return;
            }
            
            currentUser = {
                username: username,
                ...users[username]
            };
            
            loginSuccess();
        }
        
        function handleRegister() {
            const username = document.getElementById('register-username').value.trim();
            const password = document.getElementById('register-password').value.trim();
            const confirm = document.getElementById('register-confirm').value.trim();
            const errorDiv = document.getElementById('register-error');
            
            if (!username || !password || !confirm) {
                errorDiv.textContent = '–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password !== confirm) {
                errorDiv.textContent = '–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (password.length < 3) {
                errorDiv.textContent = '–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞';
                errorDiv.style.display = 'block';
                return;
            }
            
            if (users[username]) {
                errorDiv.textContent = '–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';
                errorDiv.style.display = 'block';
                return;
            }
            
            const newUser = {
                password: password,
                level: 1,
                games: 0,
                created: Date.now(),
                colors: {
                    head: '#ffccaa',
                    body: '#3366ff',
                    legs: '#2244aa',
                    arms: '#2244aa'
                },
                friends: {},
                friendRequests: {}
            };
            
            users[username] = newUser;
            saveUsers();
            
            currentUser = {
                username: username,
                ...newUser
            };
            
            loginSuccess();
        }
        
        function handleGuest() {
            currentUser = {
                username: '–ì–æ—Å—Ç—å_' + Math.floor(Math.random() * 10000),
                level: 1,
                games: 0,
                isGuest: true
            };
            
            loginSuccess();
        }
        
        function loginSuccess() {
            document.getElementById('sidebar-username').textContent = currentUser.username;
            document.getElementById('profile-username').textContent = currentUser.username;
            
            if (currentUser.isGuest) {
                document.getElementById('sidebar-status').innerHTML = 'üë§ <span>–ì–æ—Å—Ç—å</span>';
            } else {
                document.getElementById('sidebar-status').innerHTML = currentUser.level + ' <span>–ë–ª–∏–∑–∫–∏–π</span>';
                document.getElementById('profile-friends-count').textContent = currentUser.friends ? Object.keys(currentUser.friends).length : 0;
            }
            
            if (currentUser.colors) {
                playerColors = currentUser.colors;
                updateAllAvatars();
            }
            
            document.getElementById('login-screen').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('login-screen').style.display = 'none';
                document.getElementById('menu-container').style.display = 'flex';
                updateAllPlayersList();
            }, 500);
        }
        
        function logout() {
            if (!currentUser.isGuest && currentUser.username) {
                users[currentUser.username].colors = playerColors;
                saveUsers();
            }
            
            currentUser = null;
            
            document.getElementById('menu-container').style.display = 'none';
            document.getElementById('login-screen').style.display = 'flex';
            document.getElementById('login-screen').style.opacity = '1';
            
            document.getElementById('login-username').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-username').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-confirm').value = '';
        }
        
        // ==================== –°–ò–°–¢–ï–ú–ê –î–†–£–ó–ï–ô ====================
        function searchPlayers() {
            const query = document.getElementById('search-input').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('search-results');
            
            if (!query || query.length < 1) {
                resultsDiv.innerHTML = '<div class="no-friends">–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞</div>';
                return;
            }
            
            resultsDiv.innerHTML = '';
            
            const found = [];
            
            for (let username in users) {
                if (username.toLowerCase().includes(query) && username !== currentUser.username) {
                    found.push(username);
                }
            }
            
            if (found.length === 0) {
                resultsDiv.innerHTML = '<div class="no-friends">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>';
                return;
            }
            
            found.sort().forEach(username => {
                const userDiv = createPlayerItem(username);
                resultsDiv.appendChild(userDiv);
            });
        }
        
        function updateAllPlayersList() {
            const listDiv = document.getElementById('all-players-list');
            const countSpan = document.getElementById('total-players-count');
            
            if (!users || Object.keys(users).length === 0) {
                listDiv.innerHTML = '<div class="no-friends">–ù–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∏–≥—Ä–æ–∫–æ–≤</div>';
                countSpan.textContent = '0';
                return;
            }
            
            const allPlayers = Object.keys(users).filter(u => u !== currentUser.username).sort();
            countSpan.textContent = allPlayers.length;
            
            if (allPlayers.length === 0) {
                listDiv.innerHTML = '<div class="no-friends">–ù–µ—Ç –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤</div>';
                return;
            }
            
            listDiv.innerHTML = '';
            allPlayers.forEach(username => {
                const userDiv = createPlayerItem(username);
                listDiv.appendChild(userDiv);
            });
        }
        
        function createPlayerItem(username) {
            const userDiv = document.createElement('div');
            userDiv.className = 'player-item';
            
            const isFriend = currentUser.friends && currentUser.friends[username] === 'accepted';
            const hasRequest = currentUser.friendRequests && currentUser.friendRequests[username];
            const isPending = currentUser.friends && currentUser.friends[username] === 'pending';
            
            let buttonText = '–î–æ–±–∞–≤–∏—Ç—å –≤ –¥—Ä—É–∑—å—è';
            let buttonClass = 'friend-btn';
            let disabled = false;
            
            if (isFriend) {
                buttonText = '‚úÖ –í –¥—Ä—É–∑—å—è—Ö';
                buttonClass = 'friend-btn accepted';
                disabled = true;
            } else if (hasRequest) {
                buttonText = 'üì® –ó–∞—è–≤–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞';
                buttonClass = 'friend-btn pending';
            } else if (isPending) {
                buttonText = '‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ';
                buttonClass = 'friend-btn pending';
                disabled = true;
            }
            
            userDiv.innerHTML = `
                <div class="player-info">
                    <div class="player-avatar-small">üß±</div>
                    <div>
                        <div class="player-name">${username}</div>
                        <div class="player-status ${users[username]?.online ? 'online' : ''}">
                            ${users[username]?.online ? 'üü¢ –í —Å–µ—Ç–∏' : '‚ö™ –û—Ñ–ª–∞–π–Ω'}
                        </div>
                    </div>
                </div>
                <button class="${buttonClass}" onclick="sendFriendRequest('${username}')" ${disabled ? 'disabled' : ''}>${buttonText}</button>
            `;
            
            return userDiv;
        }
        
        function sendFriendRequest(targetUsername) {
            if (currentUser.isGuest) {
                alert('–ì–æ—Å—Ç–∏ –Ω–µ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤ –¥—Ä—É–∑—å—è');
                return;
            }
            
            const targetUser = users[targetUsername];
            if (!targetUser) return;
            
            if (!targetUser.friendRequests) targetUser.friendRequests = {};
            targetUser.friendRequests[currentUser.username] = 'pending';
            
            if (!currentUser.friends) currentUser.friends = {};
            currentUser.friends[targetUsername] = 'pending';
            
            saveUsers();
            
            searchPlayers();
            updateAllPlayersList();
            alert(`–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é ${targetUsername}`);
        }
        
        function acceptFriendRequest(username) {
            if (currentUser.isGuest) return;
            
            if (!currentUser.friends) currentUser.friends = {};
            currentUser.friends[username] = 'accepted';
            
            if (currentUser.friendRequests) {
                delete currentUser.friendRequests[username];
            }
            
            if (users[username]) {
                if (!users[username].friends) users[username].friends = {};
                users[username].friends[currentUser.username] = 'accepted';
                
                if (users[username].friendRequests) {
                    delete users[username].friendRequests[currentUser.username];
                }
            }
            
            saveUsers();
            updateFriendRequestsUI();
            updateFriendsUI();
            updateAllPlayersList();
        }
        
        function rejectFriendRequest(username) {
            if (currentUser.isGuest) return;
            
            if (currentUser.friendRequests) {
                delete currentUser.friendRequests[username];
            }
            
            if (currentUser.friends) {
                delete currentUser.friends[username];
            }
            
            if (users[username]) {
                if (users[username].friends) {
                    delete users[username].friends[currentUser.username];
                }
                if (users[username].friendRequests) {
                    delete users[username].friendRequests[currentUser.username];
                }
            }
            
            saveUsers();
            updateFriendRequestsUI();
            updateAllPlayersList();
        }
        
        function removeFriend(username) {
            if (currentUser.isGuest) return;
            
            delete currentUser.friends[username];
            
            if (users[username]) {
                delete users[username].friends[currentUser.username];
            }
            
            saveUsers();
            updateFriendsUI();
            updateAllPlayersList();
        }
        
        function joinFriend(username) {
            startGame();
        }
        
        function updateFriendRequestsUI() {
            const requestsDiv = document.getElementById('friend-requests');
            requestsDiv.innerHTML = '';
            
            if (!currentUser.friendRequests || Object.keys(currentUser.friendRequests).length === 0) {
                requestsDiv.innerHTML = '<div class="no-friends">–ù–µ—Ç –≤—Ö–æ–¥—è—â–∏—Ö –∑–∞—è–≤–æ–∫</div>';
                return;
            }
            
            for (let username in currentUser.friendRequests) {
                const requestDiv = document.createElement('div');
                requestDiv.className = 'friend-card online';
                
                requestDiv.innerHTML = `
                    <div class="friend-info">
                        <div class="friend-avatar">üß±</div>
                        <div class="friend-details">
                            <span class="friend-name">${username}</span>
                            <span class="friend-last-seen online">üü¢ –•–æ—á–µ—Ç –¥—Ä—É–∂–∏—Ç—å</span>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn accept" onclick="acceptFriendRequest('${username}')">‚úì –ü—Ä–∏–Ω—è—Ç—å</button>
                        <button class="action-btn reject" onclick="rejectFriendRequest('${username}')">‚úó –û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
                    </div>
                `;
                
                requestsDiv.appendChild(requestDiv);
            }
        }
        
        function updateFriendsUI() {
            const friendsDiv = document.getElementById('my-friends');
            friendsDiv.innerHTML = '';
            
            if (!currentUser.friends || Object.keys(currentUser.friends).length === 0) {
                friendsDiv.innerHTML = '<div class="no-friends">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';
                return;
            }
            
            const acceptedFriends = [];
            for (let username in currentUser.friends) {
                if (currentUser.friends[username] === 'accepted') {
                    acceptedFriends.push(username);
                }
            }
            
            if (acceptedFriends.length === 0) {
                friendsDiv.innerHTML = '<div class="no-friends">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';
                return;
            }
            
            acceptedFriends.sort().forEach(username => {
                const friendDiv = document.createElement('div');
                friendDiv.className = `friend-card offline`;
                
                friendDiv.innerHTML = `
                    <div class="friend-info" onclick="joinFriend('${username}')">
                        <div class="friend-avatar">üß±</div>
                        <div class="friend-details">
                            <span class="friend-name">${username}</span>
                            <span class="friend-last-seen">‚ö™ –í –∏–≥—Ä–µ</span>
                        </div>
                    </div>
                    <div class="friend-actions">
                        <button class="action-btn join" onclick="joinFriend('${username}')">üéÆ –ò–≥—Ä–∞—Ç—å</button>
                        <button class="action-btn remove" onclick="removeFriend('${username}')">‚úó</button>
                    </div>
                `;
                
                friendsDiv.appendChild(friendDiv);
            });
        }
        
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –ü–ï–†–ï–ú–ï–ù–ù–´–ï ====================
        let currentPage = 'home';
        let playerColors = {
            head: '#ffccaa',
            body: '#3366ff',
            legs: '#2244aa',
            arms: '#2244aa'
        };
        
        function switchPage(page) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.currentTarget.classList.add('active');
            
            const titles = {
                'home': '–ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞',
                'profile': '–ü—Ä–æ—Ñ–∏–ª—å',
                'avatar': '–ê–≤–∞—Ç–∞—Ä',
                'friends': '–î—Ä—É–∑—å—è'
            };
            document.getElementById('page-title').textContent = titles[page];
            
            document.querySelectorAll('.content-section').forEach(section => section.classList.remove('active'));
            document.getElementById(page + '-section').classList.add('active');
            
            if (page === 'friends') {
                updateFriendRequestsUI();
                updateFriendsUI();
                updateAllPlayersList();
                document.getElementById('search-input').value = '';
                document.getElementById('search-results').innerHTML = '<div class="no-friends">–í–≤–µ–¥–∏—Ç–µ –Ω–∏–∫ –¥–ª—è –ø–æ–∏—Å–∫–∞</div>';
            }
            
            currentPage = page;
        }
        
        function selectGame() {
            document.querySelector('.game-card-large').classList.add('selected');
        }
        
        function setPartColor(part, color, element) {
            playerColors[part] = color;
            
            const parentPicker = element.parentNode;
            Array.from(parentPicker.children).forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            
            updateAllAvatars();
            
            if (currentUser && !currentUser.isGuest) {
                users[currentUser.username].colors = playerColors;
                saveUsers();
            }
        }
        
        function updateAllAvatars() {
            const avatars = document.querySelectorAll('#sidebar-avatar, #profile-avatar, #customize-avatar');
            avatars.forEach(avatar => {
                avatar.style.backgroundColor = playerColors.body;
                avatar.style.color = 'white';
            });
        }
        
        // ==================== –ù–û–í–ê–Ø –°–ò–°–¢–ï–ú–ê: –ü–£–ë–õ–ò–ß–ù–´–ô WEBSOCKET –°–ï–†–í–ï–† ====================
        let socket = null;
        let otherPlayers = new Map();
        let myPlayerId = null;
        let reconnectAttempts = 0;
        
        function initMultiplayer() {
            return new Promise((resolve) => {
                try {
                    // –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø—É–±–ª–∏—á–Ω—ã–π WebSocket —Å–µ—Ä–≤–µ—Ä
                    // –≠—Ç–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–ª—è –≤—Å–µ—Ö
                    socket = io('https://socket-io-server-demo.glitch.me', {
                        transports: ['websocket'],
                        reconnection: true,
                        reconnectionAttempts: 5,
                        reconnectionDelay: 1000
                    });
                    
                    socket.on('connect', () => {
                        console.log('–ü–æ–¥–∫–ª—é—á–µ–Ω–æ –∫ —Å–µ—Ä–≤–µ—Ä—É, ID:', socket.id);
                        myPlayerId = socket.id;
                        document.getElementById('server-status').textContent = 'üü¢ –ù–ê –°–ï–†–í–ï–†–ï (–û–ù–õ–ê–ô–ù)';
                        document.getElementById('server-status').style.color = '#4CAF50';
                        
                        // –ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º—Å—è –∫ –∫–æ–º–Ω–∞—Ç–µ parkour
                        socket.emit('joinRoom', {
                            room: 'parkour_maze',
                            username: currentUser ? currentUser.username : '–ò–≥—Ä–æ–∫',
                            colors: playerColors
                        });
                        
                        reconnectAttempts = 0;
                        resolve();
                    });
                    
                    socket.on('connect_error', (error) => {
                        console.log('–û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:', error);
                        reconnectAttempts++;
                        
                        if (reconnectAttempts >= 5) {
                            document.getElementById('server-status').textContent = 'üü° –û–§–§–õ–ê–ô–ù –†–ï–ñ–ò–ú';
                            document.getElementById('server-status').style.color = '#ffaa00';
                            resolve();
                        }
                    });
                    
                    socket.on('roomJoined', (data) => {
                        console.log('–ö–æ–º–Ω–∞—Ç–∞:', data);
                        updatePlayersCount(data.playerCount);
                        
                        // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ—Ö —Ç–µ–∫—É—â–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                        if (data.players) {
                            data.players.forEach(player => {
                                if (player.id !== socket.id) {
                                    addOtherPlayer(player);
                                }
                            });
                        }
                    });
                    
                    socket.on('newPlayer', (player) => {
                        console.log('–ù–æ–≤—ã–π –∏–≥—Ä–æ–∫:', player);
                        addOtherPlayer(player);
                        updatePlayersCount();
                    });
                    
                    socket.on('playerMoved', (data) => {
                        updateOtherPlayer(data);
                    });
                    
                    socket.on('playerLeft', (playerId) => {
                        console.log('–ò–≥—Ä–æ–∫ —É—à–µ–ª:', playerId);
                        removeOtherPlayer(playerId);
                        updatePlayersCount();
                    });
                    
                    socket.on('playerCount', (data) => {
                        updatePlayersCount(data.count);
                    });
                    
                    socket.on('disconnect', () => {
                        console.log('–û—Ç–∫–ª—é—á–µ–Ω–æ –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞');
                        document.getElementById('server-status').textContent = 'üîµ –ü–ï–†–ï–ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï...';
                        document.getElementById('server-status').style.color = '#ffaa00';
                    });
                    
                } catch (e) {
                    console.log('WebSocket –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ω', e);
                    document.getElementById('server-status').textContent = 'üü° –û–§–§–õ–ê–ô–ù –†–ï–ñ–ò–ú';
                    document.getElementById('server-status').style.color = '#ffaa00';
                    resolve();
                }
            });
        }
        
        function addOtherPlayer(player) {
            if (!scene) return;
            
            const model = createMultiplayerModel(player.colors || playerColors);
            if (model) {
                model.position.set(player.x || 0, player.y || 5, player.z || 10);
                scene.add(model);
                
                otherPlayers.set(player.id, {
                    model: model,
                    targetPos: new THREE.Vector3(player.x || 0, player.y || 5, player.z || 10),
                    username: player.username || '–ò–≥—Ä–æ–∫'
                });
            }
        }
        
        function updateOtherPlayer(data) {
            if (otherPlayers.has(data.id)) {
                const player = otherPlayers.get(data.id);
                if (player) {
                    player.targetPos.set(data.x, data.y, data.z);
                }
            }
        }
        
        function removeOtherPlayer(id) {
            if (otherPlayers.has(id)) {
                const player = otherPlayers.get(id);
                if (player && player.model && scene) {
                    scene.remove(player.model);
                }
                otherPlayers.delete(id);
            }
        }
        
        function updatePlayersCount(count) {
            if (count !== undefined) {
                document.getElementById('players-count').textContent = `üë• ${count} –≤ –º–∏—Ä–µ`;
                document.getElementById('global-online').textContent = count;
                document.getElementById('game-players').textContent = count;
            } else if (socket) {
                socket.emit('getPlayerCount', { room: 'parkour_maze' });
            }
        }
        
        function sendPosition(x, y, z) {
            if (socket && socket.connected) {
                socket.emit('move', {
                    room: 'parkour_maze',
                    x: x,
                    y: y,
                    z: z
                });
            }
        }
        
        function createMultiplayerModel(colors) {
            try {
                const group = new THREE.Group();
                
                function getMaterial(hexColor) {
                    return new THREE.MeshStandardMaterial({ color: hexColor || '#3366ff' });
                }
                
                const torso = new THREE.Mesh(new THREE.BoxGeometry(1.2, 2, 0.8), getMaterial(colors.body));
                torso.position.y = 1.6;
                torso.castShadow = true;
                group.add(torso);
                
                const head = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), getMaterial(colors.head));
                head.position.y = 3;
                head.castShadow = true;
                group.add(head);
                
                const leftLeg = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.8, 0.7), getMaterial(colors.legs));
                leftLeg.position.set(-0.4, 0.2, 0);
                leftLeg.castShadow = true;
                group.add(leftLeg);
                
                const rightLeg = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.8, 0.7), getMaterial(colors.legs));
                rightLeg.position.set(0.4, 0.2, 0);
                rightLeg.castShadow = true;
                group.add(rightLeg);
                
                const leftArm = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.8, 0.5), getMaterial(colors.arms));
                leftArm.position.set(-0.8, 1.8, 0);
                leftArm.castShadow = true;
                group.add(leftArm);
                
                const rightArm = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.8, 0.5), getMaterial(colors.arms));
                rightArm.position.set(0.8, 1.8, 0);
                rightArm.castShadow = true;
                group.add(rightArm);
                
                return group;
            } catch (e) {
                return null;
            }
        }
        
        // ==================== –£–ü–†–ê–í–õ–ï–ù–ò–ï –ò–ì–†–û–ô ====================
        let scene, camera, renderer, yawObject, pitchObject, world;
        let localPlayerBody, localModel;
        let keys = {}, jumpPressed = false, spaceKeyDown = false;
        let deathBlocks = [];
        let walkTime = 0;
        
        let joystickActive = false;
        let joystickVector = { x: 0, y: 0 };
        let jumpButtonPressed = false;
        let cameraTouchActive = false;
        let lastTouchX = 0, lastTouchY = 0;
        
        async function startGame() {
            document.getElementById('menu-container').style.display = 'none';
            document.getElementById('game-container').classList.add('active');
            
            if (window.innerWidth <= 768) {
                document.getElementById('mobile-controls').classList.add('active');
            }
            
            await initMultiplayer();
            
            initThreeJSGame(document.getElementById('game-canvas'));
            initMobileControls();
        }
        
        function exitGame() {
            if (socket) {
                socket.disconnect();
            }
            
            document.getElementById('menu-container').style.display = 'flex';
            document.getElementById('game-container').classList.remove('active');
            document.getElementById('mobile-controls').classList.remove('active');
            document.getElementById('game-canvas').innerHTML = '';
            
            if (window.gameAnimation) {
                cancelAnimationFrame(window.gameAnimation);
                window.gameAnimation = null;
            }
        }
        
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const gameContainer = document.getElementById('game-container');
                if (gameContainer.classList.contains('active')) {
                    exitGame();
                }
            }
        });
        
        function initMobileControls() {
            const leftArea = document.getElementById('left-area');
            const rightArea = document.getElementById('right-area');
            const joystick = document.getElementById('joystick-left');
            const handle = document.getElementById('joystick-handle');
            const jumpBtn = document.getElementById('jump-button');
            
            leftArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                joystickActive = true;
                updateJoystick(e.touches[0]);
            });
            
            leftArea.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (joystickActive) {
                    updateJoystick(e.touches[0]);
                }
            });
            
            leftArea.addEventListener('touchend', (e) => {
                e.preventDefault();
                joystickActive = false;
                joystickVector = { x: 0, y: 0 };
                handle.style.transform = 'translate(0px, 0px)';
            });
            
            function updateJoystick(touch) {
                const rect = joystick.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                let dx = touch.clientX - centerX;
                let dy = touch.clientY - centerY;
                
                const distance = Math.sqrt(dx*dx + dy*dy);
                const maxDistance = rect.width / 2;
                
                if (distance > maxDistance) {
                    dx = (dx / distance) * maxDistance;
                    dy = (dy / distance) * maxDistance;
                }
                
                handle.style.transform = `translate(${dx}px, ${dy}px)`;
                
                joystickVector.x = dx / maxDistance;
                joystickVector.y = dy / maxDistance;
            }
            
            rightArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                cameraTouchActive = true;
                lastTouchX = e.touches[0].clientX;
                lastTouchY = e.touches[0].clientY;
            });
            
            rightArea.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (cameraTouchActive && yawObject) {
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - lastTouchX;
                    const deltaY = touch.clientY - lastTouchY;
                    
                    yawObject.rotation.y -= deltaX * 0.005;
                    if (pitchObject) {
                        pitchObject.rotation.x -= deltaY * 0.003;
                        pitchObject.rotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, pitchObject.rotation.x));
                    }
                    
                    lastTouchX = touch.clientX;
                    lastTouchY = touch.clientY;
                }
            });
            
            rightArea.addEventListener('touchend', (e) => {
                e.preventDefault();
                cameraTouchActive = false;
            });
            
            jumpBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                e.stopPropagation();
                jumpButtonPressed = true;
                jumpBtn.classList.add('active');
            });
            
            jumpBtn.addEventListener('touchend', (e) => {
                e.preventDefault();
                e.stopPropagation();
                jumpButtonPressed = false;
                jumpBtn.classList.remove('active');
            });
        }
        
        // ==================== THREE.JS –ò–ì–†–ê ====================
        function initThreeJSGame(container) {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87ceeb);
            
            camera = new THREE.PerspectiveCamera(70, window.innerWidth / window.innerHeight, 0.1, 2000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            container.appendChild(renderer.domElement);
            
            yawObject = new THREE.Object3D();
            pitchObject = new THREE.Object3D();
            yawObject.add(pitchObject);
            pitchObject.add(camera);
            scene.add(yawObject);
            
            let cameraDistance = 8;
            camera.position.set(0, 3, cameraDistance);
            
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambientLight);
            
            const dirLight = new THREE.DirectionalLight(0xffffff, 0.9);
            dirLight.position.set(20, 30, 10);
            dirLight.castShadow = true;
            scene.add(dirLight);
            
            world = new CANNON.World();
            world.gravity.set(0, -9.82, 0);
            
            const groundMaterial = new CANNON.Material("groundMaterial");
            const playerMaterial = new CANNON.Material("playerMaterial");
            
            const contactMaterial = new CANNON.ContactMaterial(playerMaterial, groundMaterial, {
                friction: 0.0,
                restitution: 0.0,
            });
            world.addContactMaterial(contactMaterial);
            world.defaultContactMaterial = contactMaterial;
            
            deathBlocks = [];
            
            function createLevel() {
                const groundMesh = new THREE.Mesh(
                    new THREE.BoxGeometry(80, 2, 80),
                    new THREE.MeshStandardMaterial({ color: 0x2a3a4a })
                );
                groundMesh.position.set(0, -1, 0);
                groundMesh.receiveShadow = true;
                scene.add(groundMesh);
                
                const groundBody = new CANNON.Body({ mass: 0, material: groundMaterial });
                groundBody.addShape(new CANNON.Box(new CANNON.Vec3(40, 1, 40)));
                groundBody.position.copy(groundMesh.position);
                world.addBody(groundBody);
                
                const mazeStartX = 15;
                const mazeStartZ = -20;
                
                const wallPositions = [
                    [mazeStartX, 2, mazeStartZ, 20, 4, 1],
                    [mazeStartX + 20, 2, mazeStartZ, 1, 4, 20],
                    [mazeStartX, 2, mazeStartZ - 10, 20, 4, 1],
                    [mazeStartX, 2, mazeStartZ + 10, 20, 4, 1],
                    [mazeStartX + 5, 2, mazeStartZ - 5, 1, 4, 8],
                    [mazeStartX + 10, 2, mazeStartZ + 2, 1, 4, 8],
                    [mazeStartX + 15, 2, mazeStartZ - 3, 1, 4, 8],
                    [mazeStartX + 8, 2, mazeStartZ + 5, 8, 4, 1],
                    [mazeStartX + 12, 2, mazeStartZ - 7, 8, 4, 1],
                ];
                
                wallPositions.forEach(pos => {
                    const wallMesh = new THREE.Mesh(
                        new THREE.BoxGeometry(pos[3], pos[4], pos[5]),
                        new THREE.MeshStandardMaterial({ color: 0x8B4513 })
                    );
                    wallMesh.position.set(pos[0], pos[1], pos[2]);
                    wallMesh.castShadow = true;
                    wallMesh.receiveShadow = true;
                    scene.add(wallMesh);
                    
                    const wallBody = new CANNON.Body({ mass: 0, material: groundMaterial });
                    wallBody.addShape(new CANNON.Box(new CANNON.Vec3(pos[3]/2, pos[4]/2, pos[5]/2)));
                    wallBody.position.copy(wallMesh.position);
                    world.addBody(wallBody);
                });
                
                const entranceMesh = new THREE.Mesh(
                    new THREE.BoxGeometry(2, 1, 2),
                    new THREE.MeshStandardMaterial({ color: 0x4CAF50 })
                );
                entranceMesh.position.set(mazeStartX + 2, 0.5, mazeStartZ - 5);
                entranceMesh.castShadow = true;
                entranceMesh.receiveShadow = true;
                scene.add(entranceMesh);
                
                for (let i = 0; i < 5; i++) {
                    const deathMesh = new THREE.Mesh(
                        new THREE.BoxGeometry(1.5, 0.5, 1.5),
                        new THREE.MeshStandardMaterial({ color: 0xff3333, emissive: 0x330000 })
                    );
                    deathMesh.position.set(mazeStartX + 5 + i*3, 0.5, mazeStartZ - 2);
                    deathMesh.castShadow = true;
                    deathMesh.receiveShadow = true;
                    scene.add(deathMesh);
                    
                    const deathBody = new CANNON.Body({ mass: 0, material: groundMaterial, collisionResponse: false });
                    deathBody.addShape(new CANNON.Box(new CANNON.Vec3(0.75, 0.25, 0.75)));
                    deathBody.position.copy(deathMesh.position);
                    world.addBody(deathBody);
                    deathBlocks.push(deathBody);
                }
                
                for (let i = 0; i < 20; i++) {
                    const platformMesh = new THREE.Mesh(
                        new THREE.BoxGeometry(3, 0.5, 3),
                        new THREE.MeshStandardMaterial({ color: new THREE.Color().setHSL(i / 20, 0.8, 0.5) })
                    );
                    
                    let x, z;
                    if (i < 10) {
                        x = -10;
                        z = -10 - i * 6;
                    } else {
                        x = -15 + Math.sin(i) * 8;
                        z = -70 - (i-10) * 5;
                    }
                    
                    platformMesh.position.set(x, 1 + i * 1.5, z);
                    platformMesh.castShadow = true;
                    platformMesh.receiveShadow = true;
                    scene.add(platformMesh);
                    
                    const platformBody = new CANNON.Body({ mass: 0, material: groundMaterial });
                    platformBody.addShape(new CANNON.Box(new CANNON.Vec3(1.5, 0.25, 1.5)));
                    platformBody.position.copy(platformMesh.position);
                    world.addBody(platformBody);
                    
                    if (i % 3 === 0 && i > 5) {
                        const deathMesh = new THREE.Mesh(
                            new THREE.BoxGeometry(1.2, 0.5, 1.2),
                            new THREE.MeshStandardMaterial({ color: 0xff3333, emissive: 0x330000 })
                        );
                        deathMesh.position.set(platformMesh.position.x + 1, 1.8, platformMesh.position.z);
                        deathMesh.castShadow = true;
                        deathMesh.receiveShadow = true;
                        scene.add(deathMesh);
                        
                        const deathBody = new CANNON.Body({ mass: 0, material: groundMaterial, collisionResponse: false });
                        deathBody.addShape(new CANNON.Box(new CANNON.Vec3(0.6, 0.25, 0.6)));
                        deathBody.position.copy(deathMesh.position);
                        world.addBody(deathBody);
                        deathBlocks.push(deathBody);
                    }
                }
                
                const finishMesh = new THREE.Mesh(
                    new THREE.BoxGeometry(5, 0.5, 5),
                    new THREE.MeshStandardMaterial({ color: 0xffaa00, emissive: 0x442200 })
                );
                finishMesh.position.set(0, 0.5, -150);
                finishMesh.castShadow = true;
                finishMesh.receiveShadow = true;
                scene.add(finishMesh);
            }
            
            createLevel();
            
            localPlayerBody = new CANNON.Body({
                mass: 5,
                material: playerMaterial,
                linearDamping: 0.0,
                angularDamping: 0.0,
                fixedRotation: true
            });
            localPlayerBody.addShape(new CANNON.Sphere(0.9));
            localPlayerBody.position.set(0, 5, 10);
            world.addBody(localPlayerBody);
            
            localModel = createCustomPlayerModel();
            scene.add(localModel);
            
            function createCustomPlayerModel() {
                const group = new THREE.Group();
                
                function getMaterial(hexColor) {
                    return new THREE.MeshStandardMaterial({ color: hexColor });
                }
                
                const torso = new THREE.Mesh(new THREE.BoxGeometry(1.2, 2, 0.8), getMaterial(playerColors.body));
                torso.position.y = 1.6;
                torso.castShadow = true;
                group.add(torso);
                
                const head = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 1.2), getMaterial(playerColors.head));
                head.position.y = 3;
                head.castShadow = true;
                group.add(head);
                
                const leftLeg = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.8, 0.7), getMaterial(playerColors.legs));
                leftLeg.position.set(-0.4, 0.2, 0);
                leftLeg.castShadow = true;
                group.add(leftLeg);
                
                const rightLeg = new THREE.Mesh(new THREE.BoxGeometry(0.7, 1.8, 0.7), getMaterial(playerColors.legs));
                rightLeg.position.set(0.4, 0.2, 0);
                rightLeg.castShadow = true;
                group.add(rightLeg);
                
                const leftArm = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.8, 0.5), getMaterial(playerColors.arms));
                leftArm.position.set(-0.8, 1.8, 0);
                leftArm.castShadow = true;
                group.add(leftArm);
                
                const rightArm = new THREE.Mesh(new THREE.BoxGeometry(0.5, 1.8, 0.5), getMaterial(playerColors.arms));
                rightArm.position.set(0.8, 1.8, 0);
                rightArm.castShadow = true;
                group.add(rightArm);
                
                return group;
            }
            
            keys = {};
            jumpPressed = false;
            spaceKeyDown = false;
            
            document.addEventListener("keydown", (e) => {
                keys[e.code] = true;
                
                if (e.code === "Space" && !spaceKeyDown) {
                    jumpPressed = true;
                    spaceKeyDown = true;
                }
            });
            
            document.addEventListener("keyup", (e) => {
                keys[e.code] = false;
                
                if (e.code === "Space") {
                    spaceKeyDown = false;
                }
            });
            
            let mouseDown = false;
            document.addEventListener("mousedown", (e) => {
                if (e.button === 2) mouseDown = true;
            });
            document.addEventListener("mouseup", (e) => {
                if (e.button === 2) mouseDown = false;
            });
            document.addEventListener("mousemove", (e) => {
                if (!mouseDown) return;
                yawObject.rotation.y -= e.movementX * 0.002;
                pitchObject.rotation.x -= e.movementY * 0.002;
                pitchObject.rotation.x = Math.max(-Math.PI / 3, Math.min(Math.PI / 3, pitchObject.rotation.x));
            });
            
            const spawnPosition = new CANNON.Vec3(0, 5, 10);
            const deathHeight = -10;
            
            const groundIndicator = document.getElementById('ground-indicator');
            
            function isOnGround() {
                return Math.abs(localPlayerBody.velocity.y) < 0.1;
            }
            
            walkTime = 0;
            let lastSendTime = 0;
            
            function animate() {
                window.gameAnimation = requestAnimationFrame(animate);
                
                const delta = 0.016;
                world.step(1 / 60, delta, 3);
                
                let dead = false;
                
                if (localPlayerBody.position.y < deathHeight) {
                    dead = true;
                }
                
                if (!dead) {
                    const playerPos = localPlayerBody.position;
                    const playerRadius = 0.9;
                    
                    for (let block of deathBlocks) {
                        const blockPos = block.position;
                        const dx = playerPos.x - blockPos.x;
                        const dy = playerPos.y - blockPos.y;
                        const dz = playerPos.z - blockPos.z;
                        
                        const distance = Math.sqrt(dx*dx + dy*dy + dz*dz);
                        
                        if (distance < playerRadius + 1.0) {
                            dead = true;
                            break;
                        }
                    }
                }
                
                if (dead) {
                    localPlayerBody.position.copy(spawnPosition);
                    localPlayerBody.velocity.set(0, 0, 0);
                }
                
                const moveSpeed = 12;
                let moveX = 0, moveZ = 0;
                
                if (keys["KeyW"]) moveZ += 1;
                if (keys["KeyS"]) moveZ -= 1;
                if (keys["KeyA"]) moveX -= 1;
                if (keys["KeyD"]) moveX += 1;
                
                if (joystickActive) {
                    moveX += joystickVector.x;
                    moveZ += -joystickVector.y;
                }
                
                if (moveX !== 0 || moveZ !== 0) {
                    const len = Math.sqrt(moveX*moveX + moveZ*moveZ);
                    moveX /= len;
                    moveZ /= len;
                    
                    const angle = Math.atan2(moveX, moveZ);
                    localModel.rotation.y = angle;
                }
                
                const forward = new THREE.Vector3(0, 0, -1).applyQuaternion(yawObject.quaternion);
                const right = new THREE.Vector3(1, 0, 0).applyQuaternion(yawObject.quaternion);
                
                forward.y = 0;
                right.y = 0;
                forward.normalize();
                right.normalize();
                
                localPlayerBody.velocity.x = (forward.x * moveZ + right.x * moveX) * moveSpeed;
                localPlayerBody.velocity.z = (forward.z * moveZ + right.z * moveX) * moveSpeed;
                
                const onGround = isOnGround();
                
                if (onGround) {
                    groundIndicator.textContent = 'üü¢ –ù–ê –ó–ï–ú–õ–ï';
                    groundIndicator.classList.add('onground');
                    groundIndicator.classList.remove('air');
                } else {
                    groundIndicator.textContent = 'üî¥ –í –í–û–ó–î–£–•–ï';
                    groundIndicator.classList.add('air');
                    groundIndicator.classList.remove('onground');
                }
                
                if (jumpPressed && onGround) {
                    localPlayerBody.velocity.y = 10;
                    jumpPressed = false;
                }
                
                if (jumpButtonPressed && onGround) {
                    localPlayerBody.velocity.y = 10;
                    jumpButtonPressed = false;
                    document.getElementById('jump-button').classList.remove('active');
                }
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏—é –Ω–∞ —Å–µ—Ä–≤–µ—Ä (—Ä–∞–∑ –≤ 100–º—Å)
                const now = Date.now();
                if (now - lastSendTime > 100 && socket && socket.connected) {
                    sendPosition(localPlayerBody.position.x, localPlayerBody.position.y, localPlayerBody.position.z);
                    lastSendTime = now;
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –ø–æ–∑–∏—Ü–∏–∏ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤
                otherPlayers.forEach((player) => {
                    if (player.model && player.targetPos) {
                        player.model.position.lerp(player.targetPos, 0.3);
                    }
                });
                
                const moving = Math.abs(localPlayerBody.velocity.x) > 0.1 || Math.abs(localPlayerBody.velocity.z) > 0.1;
                if (moving) walkTime += delta * 12;
                
                if (localModel.children.length >= 6) {
                    const leftLeg = localModel.children[2];
                    const rightLeg = localModel.children[3];
                    const leftArm = localModel.children[4];
                    const rightArm = localModel.children[5];
                    
                    if (moving) {
                        const swing = Math.sin(walkTime) * 0.7;
                        leftLeg.rotation.x = swing;
                        rightLeg.rotation.x = -swing;
                        leftArm.rotation.x = -swing;
                        rightArm.rotation.x = swing;
                    } else {
                        leftLeg.rotation.x = 0;
                        rightLeg.rotation.x = 0;
                        leftArm.rotation.x = 0;
                        rightArm.rotation.x = 0;
                    }
                }
                
                camera.position.set(0, 3, cameraDistance);
                localModel.position.copy(localPlayerBody.position);
                yawObject.position.copy(localPlayerBody.position);
                
                renderer.render(scene, camera);
            }
            
            animate();
            
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        }
    </script>
</body>
</html>
